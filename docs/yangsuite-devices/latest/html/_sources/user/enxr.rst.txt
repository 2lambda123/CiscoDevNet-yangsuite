Setting Device to EnXR
======================

EnXR is a device simulator based on an XR image and it is used for development.
After building the EnXR image, the XR simulator is brought up running in a
process on the Cisco ADS server.  Another process is then started and NETCONF
commands are sent through POSIX pipes.

**You must install YANG Suite in the EnXR workspace.**

**Be sure to allow remote access to run from laptop browser.**

Installing YANG Suite in EnXR
-----------------------------

YANG Suite must be installed inside your EnXR workspace in order for it
to operate after starting the EnXR.  Copy the setup_yangsuite.sh install
script into your workspace and execute it.  Be sure to answer "yes" when
prompted "Allow remote access <y/n>:".

For a full guide on how to build and operate the EnXR simulator go to:
http://enwiki.cisco.com/EnXR

Here are the steps that worked as of 2/22/2019:

#. ssh <your ADS> (must be CEL7 or above)
#. cd /nobackup/<CEC username>/
#. mkdir enxr
#. cd enxr
#. acme pull -sb ios_ena -lineup xr-dev.lu -plat enxr
#. tools/misc/xr_bld -core -plat enxr
#. lboot -m (wait for config to load)
#. exec
#. conf t
#. netconf-yang agent ssh
#. commit
#. end
#. Leave terminal open and start new terminal
#. ssh <your ADS>
#. cd /nobackup/<CEC username>/enxr
#. lboot -mc
#. netconf_sshd_proxy -i 0 -o 1 -u lab
#. **IF YOU DO NOT SEE A NETCONF HELLO PACKET RESPONSE, EnXR IS NOT WORKING!!!**
#. ctrl-c
#. exit
#. mkdir ysuite
#. cp /ws/miott-sjc/ysuite/setup_yangsuite.sh ysuite
#. ysuite/setup_yangsuite.sh (say yes to “allow remote access”)
#. ctrl-c
#. lboot -mc
#. /nobackup/<CEC username>/enxr/ysuite/yangsuite/start.sh
#. Leave terminal open, start browser on laptop, and point to <your ADS>:8480
#. Go to Admin-->Manage plugins and install yangsuite-testmanager
#. See section "Configuring EnXR in Device Profile"

Starting YANG Suite in an EnXR
------------------------------

After YANG Suite is installed in the EnXR workspace, bring up the XR instance
in a terminal window, the XR connector instance in another terminal window, and
start YANG Suite in the XR connector terminal using the full path to the
start.sh script.

XR instance terminal:
::

  cd /nobackup/joego/enxr1
  lboot -m

XR connector terminal with YANG Suite installed in /nobackup/joego/enxr1/ysuite:
::

  cd /nobackup/joego/enxr1
  lboot -mc
  /nobackup/joego/enxr1/ysuite/yangsuite/start.sh

Assuming you installed YANG Suite allowing remote access, run YANG Suite from
your laptop browser pointing the URL to your Cisco ADS install.

Configuring EnXR in Device Profile
----------------------------------

In the General section of the device profile, configure the "Address" of your
ADS box running EnXR.  Authentication is not enforced so any value in user and
password is ok.

In the NETCONF section, check the "Device Supports NETCONF" checkbox and set
the NETCONF "Device Variant" to "Cisco IOS XR (EnXR)".

In the SSH section of the device profile, set the "Device Variant" to
"cisco_enxr".  Accept all the default values.

Click on "Check Connectivity" and if everything is configured correctly and
the EnXR simulator is operating correctly, you should see success for ping,
NETCONF, and SSH.

YANG Suite will operate on the EnXR device just as it would with any other
device.
